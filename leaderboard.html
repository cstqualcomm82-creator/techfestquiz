<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Leaderboard - Qualcomm CST Quiz</title>
    <link rel="icon" href="data:image/svg+xml,%3csvg viewBox='0 0 783.6 144' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M-125.7-125.7h1035v395.4h-1035z' fill='none'%3e%3c/path%3e%3cpath d='M211.5 41.3c2.1 0 3.9 1.7 3.9 3.9v74.5c0 2.1-1.9 3.8-3.9 3.8h-10.1c-1.9 0-3.8-1.5-3.8-3.6V113c-5.1 7.5-13.9 12.7-26.7 12.7-21.4 0-34.6-14.2-34.6-35.3V45c0-2.1 1.9-3.8 3.9-3.8h10.1c2.1 0 3.8 1.7 3.8 3.8v42.5c0 13.7 7.2 22.8 21.4 22.8 13.9 0 22.1-9.4 22.1-22.6V45c0-2.1 1.9-3.8 3.8-3.8h10.1M62.5 0C27.9 0 0 26.9 0 62.8c0 36 27.9 62.8 62.5 62.8 5.9 0 11.6-.8 17-2.3l6.8 17.5c.7 1.9 2.1 3.1 4.6 3.1h10.8c2.6 0 4.5-1.7 3.3-5L96.2 116c17.3-10.9 28.8-30.2 28.8-53.3C125 26.9 97.1 0 62.5 0m27.2 99.3l-7.9-20.5c-.7-1.7-2.1-3.3-5.1-3.3H66.4c-2.6 0-4.6 1.7-3.4 5l10.4 26.9c-3.4.9-7.1 1.3-10.9 1.3-25.3 0-43.3-19.9-43.3-45.9s18-45.9 43.3-45.9 43.3 19.9 43.3 45.9c0 15.2-6.1 28.2-16.1 36.5m693.6 20c.9 2.1-.2 4.1-2.7 4.1h-11.3c-2.1 0-3.8-1-4.5-3.1l-20.9-56.2-21.2 56.2c-.9 2.2-2.4 3.1-4.5 3.1h-10.1c-2.1 0-3.6-.9-4.5-3.1l-21.4-56.5-21.1 56.5c-.9 2.1-2.4 3.1-4.5 3.1H646c-2.1 0-3.6-1-4.5-3.1l-20.9-56.5-21.6 56.5c-.9 2.2-2.4 3.1-4.5 3.1h-10.1c-2.1 0-3.6-.9-4.5-3.1l-21.1-56.5-21.1 56.5c-.7 2.1-2.4 3.1-4.5 3.1h-11c-2.6 0-3.6-2.1-2.7-4.1l28.6-74.8c.9-2.2 2.4-3.3 4.5-3.3h12.3c2.1 0 3.6 1 4.5 3.3L590 99.1l20.4-54.6c.9-2.2 2.4-3.3 4.5-3.3H627c2.1 0 3.6 1 4.5 3.3l20.2 54.6 20.2-54.6c.9-2.2 2.4-3.3 4.5-3.3h12.2c2.1 0 3.6 1 4.5 3.3l20.5 54.6 20-54.6c.9-2.2 2.4-3.3 4.5-3.3h12.3c2.1 0 3.6 1 4.5 3.3l28.4 74.8m-473.9-78h-10.1c-2.1 0-3.9 1.7-3.9 3.9V52c-5.1-7.7-15.1-13.2-26.9-13.2-22.3 0-41.4 17.6-41.4 43.3 0 26 19.2 43.5 41.3 43.5 12 0 21.7-5.5 27.1-13.2v7.2c0 2.1 1.9 3.8 3.9 3.8h10.1c2.1 0 3.8-1.7 3.8-3.8V45.2c-.1-2.2-1.8-3.9-3.9-3.9m-39 67.9c-14.7 0-25.2-12-25.2-26.9 0-15.1 10.4-26.7 25.2-26.7 14.6 0 25.2 11.6 25.2 26.7-.1 15-10.7 26.9-25.2 26.9m159.5 2.6c2.2 2.7.3 4.8-.9 5.7-7 5.3-16.3 8.2-26.4 8.2-25.5 0-42.5-18.7-42.5-43.3s17-43.5 42.5-43.5c10.1 0 19.3 2.9 26.4 8.2 1.2.9 2.9 2.7.9 5.7l-4.8 6.7c-1.9 2.6-4.1 1.9-6 .7-4.5-2.7-9.8-5-15.9-5-14.9 0-24.8 12-24.8 27.2s9.9 27.1 24.8 27.1c6.2 0 11.1-2.4 15.6-5 1.9-1 3.9-1.9 6 .9l5.1 6.4zM477.5 39c-24 0-43.1 18.8-43.1 43.3 0 24.7 19.2 43.3 43.1 43.3 24 0 43.1-18.7 43.1-43.3.1-24.4-19.1-43.3-43.1-43.3m0 70.1c-14.7 0-25.2-11.8-25.2-26.7 0-15.1 10.4-26.7 25.2-26.7 14.7 0 25.2 11.6 25.2 26.7 0 14.9-10.4 26.7-25.2 26.7M344.8 2.2c2.2 0 3.8 1.9 3.8 3.9v113.4c0 2.1-1.5 3.9-3.8 3.9h-10.1c-2.1 0-3.9-1.9-3.9-3.9V6.2c0-2.1 1.9-3.9 3.9-3.9h10.1' fill='%233253DC'%3e%3c/path%3e%3c/svg%3e">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #3253DC;
            --primary-light: rgba(50, 83, 220, 0.1);
            --white: #FFFFFF;
            --light-gray: #F5F7FA;
            --medium-gray: #E1E5EE;
            --dark-gray: #6B7280;
            --text-color: #1F2937;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --primary-color: #5D78FF;
            --primary-light: rgba(93, 120, 255, 0.1);
            --white: #0F172A;
            --light-gray: #1E293B;
            --medium-gray: #334155;
            --dark-gray: #94A3B8;
            --text-color: #E2E8F0;
            --shadow-color: rgba(0, 0, 0, 0.25);
        }

        [data-theme='dark'] .modern-table th {
            color: var(--text-color);
            background-color: #334155;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: var(--light-gray);
            background-image: radial-gradient(circle at top right, var(--primary-light) 0%, transparent 40%),
                              radial-gradient(circle at bottom left, var(--primary-light) 0%, transparent 30%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }
        
        .logo {
            width: 180px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            font-weight: 700;
            font-size: 2.2rem;
            color: var(--primary-color);
        }
        
        .card {
            background: rgba(255, 255, 255, 0);
            backdrop-filter: blur(12px) saturate(150%);
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 var(--shadow-color);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .leaderboard-table-container {
            overflow-x: auto;
        }
        
        .modern-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            color: var(--text-color);
        }
        
        .modern-table th,
        .modern-table td {
            padding: 12px 15px;
            text-align: left;
        }
        
        .modern-table th {
            background: var(--light-gray);
            color: var(--text-color);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }
        
        .modern-table tbody tr {
            border-bottom: 1px solid var(--medium-gray);
        }
        
        .modern-table tbody tr:last-child {
            border-bottom: none;
        }
        
        /* Loader Styles */
        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid var(--text-color);
            border-radius: 50%;
            display: inline-block;
            position: relative;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
            margin: 40px auto;
        }
        .loader::after {
            content: '';  
            box-sizing: border-box;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid;
            border-color: var(--primary-color) transparent;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        } 
        
        .no-data-message {
            text-align: center;
            padding: 20px;
            color: var(--dark-gray);
            font-style: italic;
        }
        
        .controls {
            text-align: center;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #2845c7;
            box-shadow: 0 0 15px 0 var(--primary-medium);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .card {
                padding: 20px;
            }

            .btn {
                width: 100%;
            }
        }

        /* Theme Switcher */
        .theme-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        #theme-toggle {
            background: var(--light-gray);
            border: 1px solid var(--medium-gray);
            color: var(--text-color);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        #theme-toggle:hover {
            background: var(--medium-gray);
        }

        .sun-and-moon {
            transform-origin: center center;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        html[data-theme='dark'] .sun-and-moon {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <div class="container">
            <div class="theme-switcher">
                <button id="theme-toggle">
                    <svg class="sun-and-moon" aria-hidden="true" width="24" height="24" viewBox="0 0 24 24">
                        <mask class="moon" id="moon-mask">
                            <rect x="0" y="0" width="100%" height="100%" fill="white" />
                            <circle cx="24" cy="10" r="6" fill="black" />
                        </mask>
                        <circle class="sun" cx="12" cy="12" r="6" mask="url(#moon-mask)" fill="currentColor" />
                        <g class="sun-beams" stroke="currentColor">
                            <line x1="12" y1="1" x2="12" y2="3" />
                            <line x1="12" y1="21" x2="12" y2="23" />
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                            <line x1="1" y1="12" x2="3" y2="12" />
                            <line x1="21" y1="12" x2="23" y2="12" />
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                        </g>
                    </svg>
                </button>
            </div>
        <div class="logo-container">
            <svg viewBox="0 0 783.6 144" xmlns="http://www.w3.org/2000/svg" class="logo" style="fill: var(--primary-color);"><path d="M-125.7-125.7h1035v395.4h-1035z" fill="none"></path><path d="M211.5 41.3c2.1 0 3.9 1.7 3.9 3.9v74.5c0 2.1-1.9 3.8-3.9 3.8h-10.1c-1.9 0-3.8-1.5-3.8-3.6V113c-5.1 7.5-13.9 12.7-26.7 12.7-21.4 0-34.6-14.2-34.6-35.3V45c0-2.1 1.9-3.8 3.9-3.8h10.1c2.1 0 3.8 1.7 3.8 3.8v42.5c0 13.7 7.2 22.8 21.4 22.8 13.9 0 22.1-9.4 22.1-22.6V45c0-2.1 1.9-3.8 3.8-3.8h10.1M62.5 0C27.9 0 0 26.9 0 62.8c0 36 27.9 62.8 62.5 62.8 5.9 0 11.6-.8 17-2.3l6.8 17.5c.7 1.9 2.1 3.1 4.6 3.1h10.8c2.6 0 4.5-1.7 3.3-5L96.2 116c17.3-10.9 28.8-30.2 28.8-53.3C125 26.9 97.1 0 62.5 0m27.2 99.3l-7.9-20.5c-.7-1.7-2.1-3.3-5.1-3.3H66.4c-2.6 0-4.6 1.7-3.4 5l10.4 26.9c-3.4.9-7.1 1.3-10.9 1.3-25.3 0-43.3-19.9-43.3-45.9s18-45.9 43.3-45.9 43.3 19.9 43.3 45.9c0 15.2-6.1 28.2-16.1 36.5m693.6 20c.9 2.1-.2 4.1-2.7 4.1h-11.3c-2.1 0-3.8-1-4.5-3.1l-20.9-56.2-21.2 56.2c-.9 2.2-2.4 3.1-4.5 3.1h-10.1c-2.1 0-3.6-.9-4.5-3.1l-21.4-56.5-21.1 56.5c-.9 2.1-2.4 3.1-4.5 3.1H646c-2.1 0-3.6-1-4.5-3.1l-20.9-56.5-21.6 56.5c-.9 2.2-2.4 3.1-4.5 3.1h-10.1c-2.1 0-3.6-.9-4.5-3.1l-21.1-56.5-21.1 56.5c-.7 2.1-2.4 3.1-4.5 3.1h-11c-2.6 0-3.6-2.1-2.7-4.1l28.6-74.8c.9-2.2 2.4-3.3 4.5-3.3h12.3c2.1 0 3.6 1 4.5 3.3L590 99.1l20.4-54.6c.9-2.2 2.4-3.3 4.5-3.3H627c2.1 0 3.6 1 4.5 3.3l20.2 54.6 20.2-54.6c.9-2.2 2.4-3.3 4.5-3.3h12.2c2.1 0 3.6 1 4.5 3.3l20.5 54.6 20-54.6c.9-2.2 2.4-3.3 4.5-3.3h12.3c2.1 0 3.6 1 4.5 3.3l28.4 74.8m-473.9-78h-10.1c-2.1 0-3.9 1.7-3.9 3.9V52c-5.1-7.7-15.1-13.2-26.9-13.2-22.3 0-41.4 17.6-41.4 43.3 0 26 19.2 43.5 41.3 43.5 12 0 21.7-5.5 27.1-13.2v7.2c0 2.1 1.9 3.8 3.9 3.8h10.1c2.1 0 3.8-1.7 3.8-3.8V45.2c-.1-2.2-1.8-3.9-3.9-3.9m-39 67.9c-14.7 0-25.2-12-25.2-26.9 0-15.1 10.4-26.7 25.2-26.7 14.6 0 25.2 11.6 25.2 26.7-.1 15-10.7 26.9-25.2 26.9m159.5 2.6c2.2 2.7.3 4.8-.9 5.7-7 5.3-16.3 8.2-26.4 8.2-25.5 0-42.5-18.7-42.5-43.3s17-43.5 42.5-43.5c10.1 0 19.3 2.9 26.4 8.2 1.2.9 2.9 2.7.9 5.7l-4.8 6.7c-1.9 2.6-4.1 1.9-6 .7-4.5-2.7-9.8-5-15.9-5-14.9 0-24.8 12-24.8 27.2s9.9 27.1 24.8 27.1c6.2 0 11.1-2.4 15.6-5 1.9-1 3.9-1.9 6 .9l5.1 6.4zM477.5 39c-24 0-43.1 18.8-43.1 43.3 0 24.7 19.2 43.3 43.1 43.3 24 0 43.1-18.7 43.1-43.3.1-24.4-19.1-43.3-43.1-43.3m0 70.1c-14.7 0-25.2-11.8-25.2-26.7 0-15.1 10.4-26.7 25.2-26.7 14.7 0 25.2 11.6 25.2 26.7 0 14.9-10.4 26.7-25.2 26.7M344.8 2.2c2.2 0 3.8 1.9 3.8 3.9v113.4c0 2.1-1.5 3.9-3.8 3.9h-10.1c-2.1 0-3.9-1.9-3.9-3.9V6.2c0-2.1 1.9-3.9 3.9-3.9h10.1"></path></svg>
        </div>
        
        <header>
            <h1>Full Leaderboard</h1>
        </header>
        
        <div class="card">
            <div id="loader" class="loader"></div>
            <div class="leaderboard-table-container" style="display: none;">
                <table class="modern-table" id="full-leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Score</th>
                            <th>Percentage</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="full-leaderboard-body">
                        <!-- Full leaderboard rows will be inserted here -->
                    </tbody>
                </table>
            </div>
            <div id="no-leaderboard-message" class="no-data-message" style="display: none;">
                No quiz attempts yet. Be the first to take the quiz!
            </div>
        </div>
        
        <div class="controls">
            <a href="index.html" class="btn">Back to Quiz</a>
        </div>
    </div>

    <script>
        // Fetch and display full leaderboard
        async function displayFullLeaderboard() {
            try {
                const leaderboardBody = document.getElementById('full-leaderboard-body');
                const noLeaderboardMessage = document.getElementById('no-leaderboard-message');
                
                const response = await fetch('/api/leaderboard');
                const data = await response.json();
                const allResults = data.scores || [];
                
                if (allResults.length > 0) {
                    const sortedResults = [...allResults].sort((a, b) => {
                        if (b.percentage !== a.percentage) {
                            return b.percentage - a.percentage;
                        }
                        // Convert time (MM:SS) to seconds for comparison
                        const timeA = a.timeTaken.split(':').reduce((acc, time) => (60 * acc) + +time);
                        const timeB = b.timeTaken.split(':').reduce((acc, time) => (60 * acc) + +time);
                        return timeA - timeB;
                    });
                    
                    sortedResults.forEach((result, index) => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${result.username}</td>
                            <td>${result.score}/${result.total}</td>
                            <td>${result.percentage}%</td>
                            <td>${result.timeTaken || 'N/A'}</td>
                        `;
                        leaderboardBody.appendChild(row);
                    });
                    
                    noLeaderboardMessage.style.display = 'none';
                } else {
                    noLeaderboardMessage.style.display = 'block';
                }

                // Hide loader and show content
                document.getElementById('loader').style.display = 'none';
                document.querySelector('.leaderboard-table-container').style.display = 'block';
            } catch (error) {
                console.error('Error fetching full leaderboard:', error);
                document.getElementById('loader').style.display = 'none';
                noLeaderboardMessage.textContent = 'Failed to load leaderboard. Please try again later.';
                noLeaderboardMessage.style.display = 'block';
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            displayFullLeaderboard();

            const themeToggle = document.getElementById('theme-toggle');
            const docElement = document.documentElement;

            const setStoredTheme = (theme) => localStorage.setItem('theme', theme);
            const applyTheme = (theme) => {
                docElement.setAttribute('data-theme', theme);
                setStoredTheme(theme);
            }

            const getPreferredTheme = () => {
                const storedTheme = localStorage.getItem('theme');
                if (storedTheme) return storedTheme;
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }

            applyTheme(getPreferredTheme());

            themeToggle.addEventListener('click', () => {
                const currentTheme = docElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                applyTheme(newTheme);
            });
        });
    </script>
</body>
</html>
